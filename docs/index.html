<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>mongosense</title><meta name="description" content="Documentation for mongosense"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">mongosense</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>mongosense</h2></div><div class="tsd-panel tsd-typography"><a id="md:mongosense-query-builder" class="tsd-anchor"></a><h1 class="tsd-anchor-link">MongoSense Query Builder<a href="#md:mongosense-query-builder" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p><strong>MongoSense</strong> is a flexible and easy-to-use MongoDB aggregation pipeline builder. It supports chaining, conditional stage inclusion, and logging for debugging purposes. Build complex pipelines easily with methods that map directly to MongoDBâ€™s aggregation framework.</p>
<a id="md:features" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Features<a href="#md:features" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><strong>Chaining</strong>: Chain multiple aggregation stages easily.</li>
<li><strong>Conditional Query</strong>: Skip stages when conditions aren't met (e.g., when parameters are <code>null</code> or <code>undefined</code>).</li>
<li><strong>Logging</strong>: Enable <code>debugMode</code> to log the pipeline construction process for debugging.</li>
<li><strong>MongoDB Aggregation Stages</strong>: Supports all major MongoDB aggregation stages.</li>
</ul>
<a id="md:installation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Installation<a href="#md:installation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">mongosense</span>
</code><button type="button">Copy</button></pre>

<a id="md:mongosense-factory-function" class="tsd-anchor"></a><h2 class="tsd-anchor-link">MongoSense Factory Function<a href="#md:mongosense-factory-function" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>MongoSense()</code> function is a factory that creates and returns an instance of the <code>MongoSenseQueryBuilder</code> class. This builder provides a flexible way to construct MongoDB aggregation pipelines using chained methods.</p>
<p>The <code>MongoSenseQueryBuilder</code> class provides the following key methods:</p>
<ul>
<li><code>collection()</code>: Select one or more collections.</li>
<li><code>match()</code>: Add a <code>$match</code> stage to filter documents.</li>
<li><code>sort()</code>: Add a <code>$sort</code> stage to order documents.</li>
<li><code>limit()</code>: Add a <code>$limit</code> stage to restrict the number of documents.</li>
<li><code>skip()</code>: Add a <code>$skip</code> stage to skip a number of documents.</li>
<li><code>lookup()</code>: Add a <code>$lookup</code> stage for left outer joins.</li>
<li><code>addFields()</code>, <code>$bucket()</code>, <code>$bucketAuto()</code>, <code>$count()</code>, <code>$facet()</code>, <code>$project()</code>, <code>$unwind()</code>, <code>$out()</code>, <code>$replaceRoot()</code>, <code>$merge()</code>, <code>$redact()</code>, <code>$sample()</code>.</li>
</ul>
<a id="md:usage-example" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Usage Example<a href="#md:usage-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">MongoSense</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;mongosense&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">builder</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">MongoSense</span><span class="hl-1">(</span><span class="hl-5">true</span><span class="hl-1">)  </span><span class="hl-7">// Enable debug mode</span><br/><span class="hl-1">  .</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;users&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">match</span><span class="hl-1">({ </span><span class="hl-4">isActive:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1"> })  </span><span class="hl-7">// Add $match stage</span><br/><span class="hl-1">  .</span><span class="hl-0">addFields</span><span class="hl-1">({ </span><span class="hl-4">fullName:</span><span class="hl-1"> { </span><span class="hl-4">$concat:</span><span class="hl-1"> [</span><span class="hl-2">&#39;$firstName&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39; &#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;$lastName&#39;</span><span class="hl-1">] } })  </span><span class="hl-7">// Add $addFields stage</span><br/><span class="hl-1">  .</span><span class="hl-0">project</span><span class="hl-1">({ </span><span class="hl-4">firstName:</span><span class="hl-1"> </span><span class="hl-8">1</span><span class="hl-1">, </span><span class="hl-4">lastName:</span><span class="hl-1"> </span><span class="hl-8">1</span><span class="hl-1">, </span><span class="hl-4">fullName:</span><span class="hl-1"> </span><span class="hl-8">1</span><span class="hl-1"> })  </span><span class="hl-7">// Add $project stage</span><br/><span class="hl-1">  .</span><span class="hl-0">unwind</span><span class="hl-1">(</span><span class="hl-2">&#39;$orders&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Add $unwind stage</span><br/><span class="hl-1">  .</span><span class="hl-0">count</span><span class="hl-1">(</span><span class="hl-2">&#39;orderCount&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Add $count stage</span><br/><span class="hl-1">  .</span><span class="hl-0">sample</span><span class="hl-1">(</span><span class="hl-8">10</span><span class="hl-1">)  </span><span class="hl-7">// Add $sample stage</span><br/><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">();</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">builder</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:output" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Output:<a href="#md:output" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="json"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-9">&quot;pipeline&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    { </span><span class="hl-9">&quot;$match&quot;</span><span class="hl-1">: { </span><span class="hl-9">&quot;isActive&quot;</span><span class="hl-1">: </span><span class="hl-5">true</span><span class="hl-1"> } },</span><br/><span class="hl-1">    { </span><span class="hl-9">&quot;$addFields&quot;</span><span class="hl-1">: { </span><span class="hl-9">&quot;fullName&quot;</span><span class="hl-1">: { </span><span class="hl-9">&quot;$concat&quot;</span><span class="hl-1">: [</span><span class="hl-2">&quot;$firstName&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot; &quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;$lastName&quot;</span><span class="hl-1">] } } },</span><br/><span class="hl-1">    { </span><span class="hl-9">&quot;$project&quot;</span><span class="hl-1">: { </span><span class="hl-9">&quot;firstName&quot;</span><span class="hl-1">: </span><span class="hl-8">1</span><span class="hl-1">, </span><span class="hl-9">&quot;lastName&quot;</span><span class="hl-1">: </span><span class="hl-8">1</span><span class="hl-1">, </span><span class="hl-9">&quot;fullName&quot;</span><span class="hl-1">: </span><span class="hl-8">1</span><span class="hl-1"> } },</span><br/><span class="hl-1">    { </span><span class="hl-9">&quot;$unwind&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;$orders&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">    { </span><span class="hl-9">&quot;$count&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;orderCount&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">    { </span><span class="hl-9">&quot;$sample&quot;</span><span class="hl-1">: { </span><span class="hl-9">&quot;size&quot;</span><span class="hl-1">: </span><span class="hl-8">10</span><span class="hl-1"> } }</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-9">&quot;collections&quot;</span><span class="hl-1">: [</span><span class="hl-2">&quot;users&quot;</span><span class="hl-1">]</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:api-documentation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">API Documentation<a href="#md:api-documentation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="md:mongosensedebugmode-boolean--false" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><code>MongoSense(debugMode: boolean = false)</code><a href="#md:mongosensedebugmode-boolean--false" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Creates a new instance of the MongoSenseQueryBuilder.</p>
<ul>
<li><strong>Parameters</strong>:
<ul>
<li><code>debugMode</code>: When set to <code>true</code>, enables logging of pipeline construction. Default is <code>false</code>.</li>
</ul>
</li>
</ul>
<a id="md:collection-selector" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Collection Selector<a href="#md:collection-selector" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>collection()</code> method allows you to specify one or more MongoDB collections that the query will target. This is useful for operations like <code>$lookup</code> or for multi-collection queries.</p>
<pre><code class="typescript"><span class="hl-7">// Example: Single Collection</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">builder</span><span class="hl-1"> = </span><span class="hl-0">MongoSense</span><span class="hl-1">().</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;users&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-7">// Example: Multiple Collections</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">builder</span><span class="hl-1"> = </span><span class="hl-0">MongoSense</span><span class="hl-1">().</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;users&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;orders&#39;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>You can also chain the collection selector with other methods, as shown:</p>
<pre><code class="typescript"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">pipeline</span><span class="hl-1"> = </span><span class="hl-0">MongoSense</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;users&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<a id="md:match-stage" class="tsd-anchor"></a><h3 class="tsd-anchor-link">$match Stage<a href="#md:match-stage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>match()</code> method is used to add a <code>$match</code> stage to the MongoDB aggregation pipeline. It allows you to filter documents based on a given set of criteria.</p>
<pre><code class="typescript"><span class="hl-7">// Example</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">pipeline</span><span class="hl-1"> = </span><span class="hl-0">MongoSense</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;users&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Select the &#39;users&#39; collection</span><br/><span class="hl-1">  .</span><span class="hl-0">match</span><span class="hl-1">({ </span><span class="hl-4">isActive:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1"> })  </span><span class="hl-7">// Filter for active users</span><br/><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">();</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">pipeline</span><span class="hl-1">);</span><br/><br/><span class="hl-7">// Output:</span><br/><span class="hl-7">// [</span><br/><span class="hl-7">//   { $match: { isActive: true } }</span><br/><span class="hl-7">// ]</span>
</code><button type="button">Copy</button></pre>

<ul>
<li>Parameters:
<ul>
<li>criteria: An object representing the filter criteria. This is similar to the MongoDB find() query.</li>
</ul>
</li>
<li>Returns: The instance of the MongoSenseQueryBuilder for method chaining.</li>
</ul>
<a id="md:sort-stage" class="tsd-anchor"></a><h3 class="tsd-anchor-link">$sort Stage<a href="#md:sort-stage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>sort()</code> method is used to add a <code>$sort</code> stage to the MongoDB aggregation pipeline. It allows you to sort documents based on specific fields in either ascending or descending order.</p>
<a id="md:example" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Example:<a href="#md:example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">pipeline</span><span class="hl-1"> = </span><span class="hl-0">MongoSense</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;users&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Select the &#39;users&#39; collection</span><br/><span class="hl-1">  .</span><span class="hl-0">match</span><span class="hl-1">({ </span><span class="hl-4">isActive:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1"> })  </span><span class="hl-7">// Filter for active users</span><br/><span class="hl-1">  .</span><span class="hl-0">sort</span><span class="hl-1">({ </span><span class="hl-4">age:</span><span class="hl-1"> </span><span class="hl-8">1</span><span class="hl-1"> })  </span><span class="hl-7">// Sort by age in ascending order</span><br/><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">();</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">pipeline</span><span class="hl-1">);</span><br/><span class="hl-7">// Output:</span><br/><span class="hl-7">// [</span><br/><span class="hl-7">//   { $match: { isActive: true } },</span><br/><span class="hl-7">//   { $sort: { age: 1 } }</span><br/><span class="hl-7">// ]</span>
</code><button type="button">Copy</button></pre>

<ul>
<li>Parameters:
<ul>
<li>sortCriteria: An object specifying the field names as keys and the sort order as values. Use 1 for ascending and -1 for descending.</li>
</ul>
</li>
<li>Returns: The instance of the MongoSenseQueryBuilder for method chaining.</li>
</ul>
<a id="md:limit-and-skip-stages" class="tsd-anchor"></a><h3 class="tsd-anchor-link">$limit and $skip Stages<a href="#md:limit-and-skip-stages" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>limit()</code> and <code>skip()</code> methods are used to add <code>$limit</code> and <code>$skip</code> stages to the MongoDB aggregation pipeline. These stages are essential for pagination, where <code>skip()</code> is used to skip a certain number of documents and <code>limit()</code> is used to return a limited number of documents.</p>
<pre><code class="typescript"><span class="hl-7">// Example:</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">pageSize</span><span class="hl-1"> = </span><span class="hl-8">10</span><span class="hl-1">;</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">pageNumber</span><span class="hl-1"> = </span><span class="hl-8">3</span><span class="hl-1">;  </span><span class="hl-7">// For page 3</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">skip</span><span class="hl-1"> = (</span><span class="hl-4">pageNumber</span><span class="hl-1"> - </span><span class="hl-8">1</span><span class="hl-1">) * </span><span class="hl-4">pageSize</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">pipeline</span><span class="hl-1"> = </span><span class="hl-0">MongoSense</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;users&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Select the &#39;users&#39; collection</span><br/><span class="hl-1">  .</span><span class="hl-0">skip</span><span class="hl-1">(</span><span class="hl-4">skip</span><span class="hl-1">)  </span><span class="hl-7">// Skip the first 20 documents (for page 3)</span><br/><span class="hl-1">  .</span><span class="hl-0">limit</span><span class="hl-1">(</span><span class="hl-4">pageSize</span><span class="hl-1">)  </span><span class="hl-7">// Return 10 documents</span><br/><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">();</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">pipeline</span><span class="hl-1">);</span><br/><span class="hl-7">// Output:</span><br/><span class="hl-7">// [</span><br/><span class="hl-7">//   { $skip: 20 },</span><br/><span class="hl-7">//   { $limit: 10 }</span><br/><span class="hl-7">// ]</span>
</code><button type="button">Copy</button></pre>

<ul>
<li>Parameters:
<ul>
<li>limit: The number of documents to return.</li>
<li>skip: The number of documents to skip.</li>
</ul>
</li>
<li>Returns: The instance of the MongoSenseQueryBuilder for method chaining.</li>
</ul>
<a id="md:pagination-logic" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Pagination Logic:<a href="#md:pagination-logic" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>When implementing pagination, you typically calculate how many documents to skip based on the current page number and the page size (number of items per page). Here's the formula:</p>
<ul>
<li>Skip Formula: skip = (pageNumber - 1) * pageSize</li>
<li>Limit Formula: limit = pageSize
With the skip() and limit() methods, you can easily create a paginated query.</li>
</ul>
<a id="md:lookup-stage" class="tsd-anchor"></a><h3 class="tsd-anchor-link">$lookup Stage<a href="#md:lookup-stage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>lookup()</code> method is used to add a <code>$lookup</code> stage to the MongoDB aggregation pipeline. This stage performs a left outer join with another collection, allowing you to merge documents from two collections.</p>
<pre><code class="typescript"><span class="hl-7">// Example:</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">pipeline</span><span class="hl-1"> = </span><span class="hl-0">MongoSense</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;users&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Select the &#39;users&#39; collection</span><br/><span class="hl-1">  .</span><span class="hl-0">lookup</span><span class="hl-1">(</span><span class="hl-2">&#39;orders&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;_id&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;userId&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;userOrders&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Join with the &#39;orders&#39; collection</span><br/><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">();</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">pipeline</span><span class="hl-1">);</span><br/><span class="hl-7">// Output:</span><br/><span class="hl-7">// [</span><br/><span class="hl-7">//   {</span><br/><span class="hl-7">//     $lookup: {</span><br/><span class="hl-7">//       from: &#39;orders&#39;,</span><br/><span class="hl-7">//       localField: &#39;_id&#39;,</span><br/><span class="hl-7">//       foreignField: &#39;userId&#39;,</span><br/><span class="hl-7">//       as: &#39;userOrders&#39;</span><br/><span class="hl-7">//     }</span><br/><span class="hl-7">//   }</span><br/><span class="hl-7">// ]</span>
</code><button type="button">Copy</button></pre>

<ul>
<li>Parameters:
<ul>
<li>from: The target collection to join with.</li>
<li>localField: The field from the current collection to match with the foreignField.</li>
<li>foreignField: The field from the target collection to match with the localField.</li>
<li>as: The name of the field where the joined documents will be stored.</li>
</ul>
</li>
<li>Returns: The instance of the MongoSenseQueryBuilder for method chaining.</li>
</ul>
<a id="md:group-stage" class="tsd-anchor"></a><h3 class="tsd-anchor-link">$group Stage<a href="#md:group-stage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>group()</code> method is used to add a <code>$group</code> stage to the MongoDB aggregation pipeline. This stage allows you to group documents by a specified key and perform various aggregation operations, such as <code>$sum</code>, <code>$avg</code>, <code>$min</code>, and <code>$max</code>.</p>
<pre><code class="typescript"><span class="hl-7">// Example:</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">pipeline</span><span class="hl-1"> = </span><span class="hl-0">MongoSense</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;sales&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Select the &#39;sales&#39; collection</span><br/><span class="hl-1">  .</span><span class="hl-0">group</span><span class="hl-1">({ </span><span class="hl-4">category:</span><span class="hl-1"> </span><span class="hl-2">&quot;$category&quot;</span><span class="hl-1"> }, { </span><span class="hl-4">totalSales:</span><span class="hl-1"> { </span><span class="hl-4">$sum:</span><span class="hl-1"> </span><span class="hl-2">&quot;$amount&quot;</span><span class="hl-1"> } })  </span><span class="hl-7">// Group by category and sum total sales</span><br/><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">();</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">pipeline</span><span class="hl-1">);</span><br/><span class="hl-7">// Output:</span><br/><span class="hl-7">// [</span><br/><span class="hl-7">//   {</span><br/><span class="hl-7">//     $group: {</span><br/><span class="hl-7">//       _id: { category: &quot;$category&quot; },</span><br/><span class="hl-7">//       totalSales: { $sum: &quot;$amount&quot; }</span><br/><span class="hl-7">//     }</span><br/><span class="hl-7">//   }</span><br/><span class="hl-7">// ]</span>
</code><button type="button">Copy</button></pre>

<ul>
<li>Parameters:
<ul>
<li>groupBy: Specifies the field (or fields) to group by.</li>
<li>accumulations: Defines the aggregation operations, such as $sum, $avg, $min, or $max.</li>
</ul>
</li>
<li>Returns: The instance of the MongoSenseQueryBuilder for method chaining.</li>
</ul>
<a id="md:addfields-stage" class="tsd-anchor"></a><h3 class="tsd-anchor-link">$addFields Stage<a href="#md:addfields-stage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>addFields()</code> method is used to add new fields to documents in the MongoDB aggregation pipeline.</p>
<pre><code class="typescript"><span class="hl-7">// Example</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">pipeline</span><span class="hl-1"> = </span><span class="hl-0">MongoSense</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;users&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Select the &#39;users&#39; collection</span><br/><span class="hl-1">  .</span><span class="hl-0">addFields</span><span class="hl-1">({ </span><span class="hl-4">fullName:</span><span class="hl-1"> { </span><span class="hl-4">$concat:</span><span class="hl-1"> [</span><span class="hl-2">&#39;$firstName&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39; &#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;$lastName&#39;</span><span class="hl-1">] } })  </span><span class="hl-7">// Add a fullName field</span><br/><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">();</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">pipeline</span><span class="hl-1">);</span><br/><br/><span class="hl-7">// Output:</span><br/><span class="hl-7">// [</span><br/><span class="hl-7">//   { $addFields: { fullName: { $concat: [&#39;$firstName&#39;, &#39; &#39;, &#39;$lastName&#39;] } } }</span><br/><span class="hl-7">// ]</span>
</code><button type="button">Copy</button></pre>

<ul>
<li>Parameters:
<ul>
<li><code>fields</code>: An object defining the new fields to add.</li>
</ul>
</li>
<li>Returns: The instance of the MongoSenseQueryBuilder for method chaining.</li>
</ul>
<a id="md:bucket-stage" class="tsd-anchor"></a><h3 class="tsd-anchor-link">$bucket Stage<a href="#md:bucket-stage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>bucket()</code> method is used to group documents into user-defined buckets based on a specified field.</p>
<pre><code class="typescript"><span class="hl-7">// Example</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">pipeline</span><span class="hl-1"> = </span><span class="hl-0">MongoSense</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;sales&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Select the &#39;sales&#39; collection</span><br/><span class="hl-1">  .</span><span class="hl-0">bucket</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">groupBy:</span><span class="hl-1"> </span><span class="hl-2">&quot;$amount&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">boundaries:</span><span class="hl-1"> [</span><span class="hl-8">0</span><span class="hl-1">, </span><span class="hl-8">100</span><span class="hl-1">, </span><span class="hl-8">200</span><span class="hl-1">, </span><span class="hl-8">300</span><span class="hl-1">, </span><span class="hl-8">400</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-4">default:</span><span class="hl-1"> </span><span class="hl-2">&quot;Other&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">output:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">count:</span><span class="hl-1"> { </span><span class="hl-4">$sum:</span><span class="hl-1"> </span><span class="hl-8">1</span><span class="hl-1"> },</span><br/><span class="hl-1">      </span><span class="hl-4">totalAmount:</span><span class="hl-1"> { </span><span class="hl-4">$sum:</span><span class="hl-1"> </span><span class="hl-2">&quot;$amount&quot;</span><span class="hl-1"> }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  })  </span><span class="hl-7">// Group sales by amount</span><br/><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">();</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">pipeline</span><span class="hl-1">);</span><br/><br/><span class="hl-7">// Output:</span><br/><span class="hl-7">// [</span><br/><span class="hl-7">//   { $bucket: { groupBy: &quot;$amount&quot;, boundaries: [0, 100, 200, 300, 400], default: &quot;Other&quot;, output: { count: { $sum: 1 }, totalAmount: { $sum: &quot;$amount&quot; } } } }</span><br/><span class="hl-7">// ]</span>
</code><button type="button">Copy</button></pre>

<ul>
<li>Parameters:
<ul>
<li><code>bucketSpec</code>: The bucket specification object.</li>
</ul>
</li>
<li>Returns: The instance of the MongoSenseQueryBuilder for method chaining.</li>
</ul>
<a id="md:bucketauto-stage" class="tsd-anchor"></a><h3 class="tsd-anchor-link">$bucketAuto Stage<a href="#md:bucketauto-stage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>bucketAuto()</code> method is used to automatically group documents into a specified number of buckets based on a field.</p>
<pre><code class="typescript"><span class="hl-7">// Example</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">pipeline</span><span class="hl-1"> = </span><span class="hl-0">MongoSense</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;sales&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Select the &#39;sales&#39; collection</span><br/><span class="hl-1">  .</span><span class="hl-0">bucketAuto</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">groupBy:</span><span class="hl-1"> </span><span class="hl-2">&quot;$amount&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">buckets:</span><span class="hl-1"> </span><span class="hl-8">4</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">output:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">count:</span><span class="hl-1"> { </span><span class="hl-4">$sum:</span><span class="hl-1"> </span><span class="hl-8">1</span><span class="hl-1"> },</span><br/><span class="hl-1">      </span><span class="hl-4">totalAmount:</span><span class="hl-1"> { </span><span class="hl-4">$sum:</span><span class="hl-1"> </span><span class="hl-2">&quot;$amount&quot;</span><span class="hl-1"> }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  })  </span><span class="hl-7">// Automatically group sales into 4 buckets</span><br/><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">();</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">pipeline</span><span class="hl-1">);</span><br/><br/><span class="hl-7">// Output:</span><br/><span class="hl-7">// [</span><br/><span class="hl-7">//   { $bucketAuto: { groupBy: &quot;$amount&quot;, buckets: 4, output: { count: { $sum: 1 }, totalAmount: { $sum: &quot;$amount&quot; } } } }</span><br/><span class="hl-7">// ]</span>
</code><button type="button">Copy</button></pre>

<ul>
<li>Parameters:
<ul>
<li><code>bucketAutoSpec</code>: The auto bucket specification object.</li>
</ul>
</li>
<li>Returns: The instance of the MongoSenseQueryBuilder for method chaining.</li>
</ul>
<a id="md:count-stage" class="tsd-anchor"></a><h3 class="tsd-anchor-link">$count Stage<a href="#md:count-stage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>count()</code> method is used to count the number of documents that pass through the pipeline.</p>
<pre><code class="typescript"><span class="hl-7">// Example</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">pipeline</span><span class="hl-1"> = </span><span class="hl-0">MongoSense</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;users&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Select the &#39;users&#39; collection</span><br/><span class="hl-1">  .</span><span class="hl-0">count</span><span class="hl-1">(</span><span class="hl-2">&#39;userCount&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Count the number of users</span><br/><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">();</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">pipeline</span><span class="hl-1">);</span><br/><br/><span class="hl-7">// Output:</span><br/><span class="hl-7">// [</span><br/><span class="hl-7">//   { $count: &quot;userCount&quot; }</span><br/><span class="hl-7">// ]</span>
</code><button type="button">Copy</button></pre>

<ul>
<li>Parameters:
<ul>
<li><code>field</code>: The name of the field where the count will be stored.</li>
</ul>
</li>
<li>Returns: The instance of the MongoSenseQueryBuilder for method chaining.</li>
</ul>
<a id="md:facet-stage" class="tsd-anchor"></a><h3 class="tsd-anchor-link">$facet Stage<a href="#md:facet-stage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>facet()</code> method is used to run multiple aggregation pipelines in parallel and merge the results.</p>
<pre><code class="typescript"><span class="hl-7">// Example</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">pipeline</span><span class="hl-1"> = </span><span class="hl-0">MongoSense</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;users&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Select the &#39;users&#39; collection</span><br/><span class="hl-1">  .</span><span class="hl-0">facet</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">ageFacet:</span><span class="hl-1"> [</span><br/><span class="hl-1">      { </span><span class="hl-4">$match:</span><span class="hl-1"> { </span><span class="hl-4">age:</span><span class="hl-1"> { </span><span class="hl-4">$gte:</span><span class="hl-1"> </span><span class="hl-8">18</span><span class="hl-1"> } } },</span><br/><span class="hl-1">      { </span><span class="hl-4">$count:</span><span class="hl-1"> </span><span class="hl-2">&quot;adultCount&quot;</span><span class="hl-1"> }</span><br/><span class="hl-1">    ],</span><br/><span class="hl-1">    </span><span class="hl-4">locationFacet:</span><span class="hl-1"> [</span><br/><span class="hl-1">      { </span><span class="hl-4">$match:</span><span class="hl-1"> { </span><span class="hl-4">location:</span><span class="hl-1"> { </span><span class="hl-4">$exists:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1"> } } },</span><br/><span class="hl-1">      { </span><span class="hl-4">$count:</span><span class="hl-1"> </span><span class="hl-2">&quot;locationCount&quot;</span><span class="hl-1"> }</span><br/><span class="hl-1">    ]</span><br/><span class="hl-1">  })  </span><span class="hl-7">// Run two pipelines: one to count adults, one to count users with locations</span><br/><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">();</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">pipeline</span><span class="hl-1">);</span><br/><br/><span class="hl-7">// Output:</span><br/><span class="hl-7">// [</span><br/><span class="hl-7">//   { $facet: { ageFacet: [{ $match: { age: { $gte: 18 } } }, { $count: &quot;adultCount&quot; }], locationFacet: [{ $match: { location: { $exists: true } } }, { $count: &quot;locationCount&quot; }] } }</span><br/><span class="hl-7">// ]</span>
</code><button type="button">Copy</button></pre>

<ul>
<li>Parameters:
<ul>
<li><code>facetSpec</code>: An object containing multiple pipelines to run in parallel.</li>
</ul>
</li>
<li>Returns: The instance of the MongoSenseQueryBuilder for method chaining.</li>
</ul>
<a id="md:project-stage" class="tsd-anchor"></a><h3 class="tsd-anchor-link">$project Stage<a href="#md:project-stage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>project()</code> method is used to include, exclude, or add new fields to documents in the MongoDB aggregation pipeline.</p>
<pre><code class="typescript"><span class="hl-7">// Example</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">pipeline</span><span class="hl-1"> = </span><span class="hl-0">MongoSense</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;users&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Select the &#39;users&#39; collection</span><br/><span class="hl-1">  .</span><span class="hl-0">project</span><span class="hl-1">({ </span><span class="hl-4">firstName:</span><span class="hl-1"> </span><span class="hl-8">1</span><span class="hl-1">, </span><span class="hl-4">lastName:</span><span class="hl-1"> </span><span class="hl-8">1</span><span class="hl-1">, </span><span class="hl-4">fullName:</span><span class="hl-1"> { </span><span class="hl-4">$concat:</span><span class="hl-1"> [</span><span class="hl-2">&#39;$firstName&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39; &#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;$lastName&#39;</span><span class="hl-1">] } })  </span><span class="hl-7">// Include fullName field</span><br/><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">();</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">pipeline</span><span class="hl-1">);</span><br/><br/><span class="hl-7">// Output:</span><br/><span class="hl-7">// [</span><br/><span class="hl-7">//   { $project: { firstName: 1, lastName: 1, fullName: { $concat: [&#39;$firstName&#39;, &#39; &#39;, &#39;$lastName&#39;] } } }</span><br/><span class="hl-7">// ]</span>
</code><button type="button">Copy</button></pre>

<ul>
<li>Parameters:
<ul>
<li><code>projection</code>: An object specifying the fields to include, exclude, or compute.</li>
</ul>
</li>
<li>Returns: The instance of the MongoSenseQueryBuilder for method chaining.</li>
</ul>
<a id="md:unwind-stage" class="tsd-anchor"></a><h3 class="tsd-anchor-link">$unwind Stage<a href="#md:unwind-stage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>unwind()</code> method is used to deconstruct an array field into separate documents.</p>
<pre><code class="typescript"><span class="hl-7">// Example</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">pipeline</span><span class="hl-1"> = </span><span class="hl-0">MongoSense</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;users&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Select the &#39;users&#39; collection</span><br/><span class="hl-1">  .</span><span class="hl-0">unwind</span><span class="hl-1">(</span><span class="hl-2">&#39;$orders&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Unwind the &#39;orders&#39; array field</span><br/><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">();</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">pipeline</span><span class="hl-1">);</span><br/><br/><span class="hl-7">// Output:</span><br/><span class="hl-7">// [</span><br/><span class="hl-7">//   { $unwind: &quot;$orders&quot; }</span><br/><span class="hl-7">// ]</span>
</code><button type="button">Copy</button></pre>

<ul>
<li>Parameters:
<ul>
<li><code>path</code>: The path to the array field to unwind.</li>
<li><code>options</code>: Additional unwind options (optional).</li>
</ul>
</li>
<li>Returns: The instance of the MongoSenseQueryBuilder for method chaining.</li>
</ul>
<a id="md:out-stage" class="tsd-anchor"></a><h3 class="tsd-anchor-link">$out Stage<a href="#md:out-stage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>out()</code> method is used to write the results of the pipeline to a specified collection.</p>
<pre><code class="typescript"><span class="hl-7">// Example</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">pipeline</span><span class="hl-1"> = </span><span class="hl-0">MongoSense</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;users&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Select the &#39;users&#39; collection</span><br/><span class="hl-1">  .</span><span class="hl-0">out</span><span class="hl-1">(</span><span class="hl-2">&#39;usersArchive&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Write the output to the &#39;usersArchive&#39; collection</span><br/><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">();</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">pipeline</span><span class="hl-1">);</span><br/><br/><span class="hl-7">// Output:</span><br/><span class="hl-7">// [</span><br/><span class="hl-7">//   { $out: &quot;usersArchive&quot; }</span><br/><span class="hl-7">// ]</span>
</code><button type="button">Copy</button></pre>

<ul>
<li>Parameters:
<ul>
<li><code>collection</code>: The name of the collection to output the results to.</li>
</ul>
</li>
<li>Returns: The instance of the MongoSenseQueryBuilder for method chaining.</li>
</ul>
<a id="md:replaceroot-stage" class="tsd-anchor"></a><h3 class="tsd-anchor-link">$replaceRoot Stage<a href="#md:replaceroot-stage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>replaceRoot()</code> method is used to replace the root document with a new document.</p>
<pre><code class="typescript"><span class="hl-7">// Example</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">pipeline</span><span class="hl-1"> = </span><span class="hl-0">MongoSense</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;users&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Select the &#39;users&#39; collection</span><br/><span class="hl-1">  .</span><span class="hl-0">replaceRoot</span><span class="hl-1">({ </span><span class="hl-4">newRoot:</span><span class="hl-1"> </span><span class="hl-2">&quot;$contactInfo&quot;</span><span class="hl-1"> })  </span><span class="hl-7">// Replace root with the &#39;contactInfo&#39; document</span><br/><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">();</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">pipeline</span><span class="hl-1">);</span><br/><br/><span class="hl-7">// Output:</span><br/><span class="hl-7">// [</span><br/><span class="hl-7">//   { $replaceRoot: { newRoot: &quot;$contactInfo&quot; } }</span><br/><span class="hl-7">// ]</span>
</code><button type="button">Copy</button></pre>

<ul>
<li>Parameters:
<ul>
<li><code>newRoot</code>: The document that will replace the root.</li>
</ul>
</li>
<li>Returns: The instance of the MongoSenseQueryBuilder for method chaining.</li>
</ul>
<a id="md:merge-stage" class="tsd-anchor"></a><h3 class="tsd-anchor-link">$merge Stage<a href="#md:merge-stage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>merge()</code> method is used to merge the pipeline output into an existing collection.</p>
<pre><code class="typescript"><span class="hl-7">// Example</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">pipeline</span><span class="hl-1"> = </span><span class="hl-0">MongoSense</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;users&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Select the &#39;users&#39; collection</span><br/><span class="hl-1">  .</span><span class="hl-0">merge</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">into:</span><span class="hl-1"> </span><span class="hl-2">&quot;archivedUsers&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">whenMatched:</span><span class="hl-1"> </span><span class="hl-2">&quot;merge&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">whenNotMatched:</span><span class="hl-1"> </span><span class="hl-2">&quot;insert&quot;</span><br/><span class="hl-1">  })  </span><span class="hl-7">// Merge output into the &#39;archivedUsers&#39; collection</span><br/><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">();</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">pipeline</span><span class="hl-1">);</span><br/><br/><span class="hl-7">// Output:</span><br/><span class="hl-7">// [</span><br/><span class="hl-7">//   { $merge: { into: &quot;archivedUsers&quot;, whenMatched: &quot;merge&quot;, whenNotMatched: &quot;insert&quot; } }</span><br/><span class="hl-7">// ]</span>
</code><button type="button">Copy</button></pre>

<ul>
<li>Parameters:
<ul>
<li><code>mergeSpec</code>: The merge specification.</li>
</ul>
</li>
<li>Returns: The instance of the MongoSenseQueryBuilder for method chaining.</li>
</ul>
<a id="md:redact-stage" class="tsd-anchor"></a><h3 class="tsd-anchor-link">$redact Stage<a href="#md:redact-stage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>redact()</code> method is used to restrict the content of documents based on some criteria.</p>
<pre><code class="typescript"><span class="hl-7">// Example</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">pipeline</span><span class="hl-1"> = </span><span class="hl-0">MongoSense</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;users&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Select the &#39;users&#39; collection</span><br/><span class="hl-1">  .</span><span class="hl-0">redact</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">$cond:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">if:</span><span class="hl-1"> { </span><span class="hl-4">$eq:</span><span class="hl-1"> [</span><span class="hl-2">&#39;$role&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;admin&#39;</span><span class="hl-1">] },</span><br/><span class="hl-1">      </span><span class="hl-4">then:</span><span class="hl-1"> </span><span class="hl-2">&quot;$$DESCEND&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">else:</span><span class="hl-1"> </span><span class="hl-2">&quot;$$PRUNE&quot;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  })  </span><span class="hl-7">// Restrict access to admin documents</span><br/><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">();</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">pipeline</span><span class="hl-1">);</span><br/><br/><span class="hl-7">// Output:</span><br/><span class="hl-7">// [</span><br/><span class="hl-7">//   { $redact: { $cond: { if: { $eq: [&#39;$role&#39;, &#39;admin&#39;] }, then: &quot;$$DESCEND&quot;, else: &quot;$$PRUNE&quot; } } }</span><br/><span class="hl-7">// ]</span>
</code><button type="button">Copy</button></pre>

<ul>
<li>Parameters:
<ul>
<li><code>redactExpr</code>: The redact expression object.</li>
</ul>
</li>
<li>Returns: The instance of the MongoSenseQueryBuilder for method chaining.</li>
</ul>
<a id="md:sample-stage" class="tsd-anchor"></a><h3 class="tsd-anchor-link">$sample Stage<a href="#md:sample-stage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>sample()</code> method is used to randomly select a specified number of documents from the collection.</p>
<pre><code class="typescript"><span class="hl-7">// Example</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">pipeline</span><span class="hl-1"> = </span><span class="hl-0">MongoSense</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;users&#39;</span><span class="hl-1">)  </span><span class="hl-7">// Select the &#39;users&#39; collection</span><br/><span class="hl-1">  .</span><span class="hl-0">sample</span><span class="hl-1">(</span><span class="hl-8">10</span><span class="hl-1">)  </span><span class="hl-7">// Randomly select 10 documents</span><br/><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">();</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">pipeline</span><span class="hl-1">);</span><br/><br/><span class="hl-7">// Output:</span><br/><span class="hl-7">// [</span><br/><span class="hl-7">//   { $sample: { size: 10 } }</span><br/><span class="hl-7">// ]</span>
</code><button type="button">Copy</button></pre>

<ul>
<li>Parameters:
<ul>
<li><code>size</code>: The number of documents to randomly select.</li>
</ul>
</li>
<li>Returns: The instance of the MongoSenseQueryBuilder for method chaining.</li>
</ul>
<a id="md:conditional-query-construction" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Conditional Query Construction<a href="#md:conditional-query-construction" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>MongoSense allows for dynamic and flexible query building with conditional stages. You can add stages like <code>$match</code>, <code>$sort</code>, <code>$limit</code>, <code>$skip</code>, <code>$lookup</code>, <code>$group</code>, <code>$addFields</code>, <code>$bucket</code>, <code>$bucketAuto</code>, <code>$count</code>, <code>$facet</code>, <code>$project</code>, <code>$unwind</code>, <code>$out</code>, <code>$replaceRoot</code>, <code>$merge</code>, <code>$redact</code>, and <code>$sample</code> only if the input is provided. If <code>null</code> or <code>undefined</code> is passed, the stage is skipped.</p>
<pre><code class="typescript"><span class="hl-7">// Example:</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">pipeline</span><span class="hl-1"> = </span><span class="hl-0">MongoSense</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;users&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">match</span><span class="hl-1">({ </span><span class="hl-4">isActive:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1"> })  </span><span class="hl-7">// Add $match stage if criteria is provided</span><br/><span class="hl-1">  .</span><span class="hl-0">sort</span><span class="hl-1">(</span><span class="hl-5">null</span><span class="hl-1">)  </span><span class="hl-7">// Skip $sort stage if no sorting is needed</span><br/><span class="hl-1">  .</span><span class="hl-0">limit</span><span class="hl-1">(</span><span class="hl-8">10</span><span class="hl-1">)  </span><span class="hl-7">// Add $limit stage if provided</span><br/><span class="hl-1">  .</span><span class="hl-0">addFields</span><span class="hl-1">(</span><span class="hl-5">null</span><span class="hl-1">)  </span><span class="hl-7">// Skip $addFields stage if no fields are provided</span><br/><span class="hl-1">  .</span><span class="hl-0">sample</span><span class="hl-1">(</span><span class="hl-8">10</span><span class="hl-1">)  </span><span class="hl-7">// Add $sample stage if size is provided</span><br/><span class="hl-1">  .</span><span class="hl-0">build</span><span class="hl-1">();</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">pipeline</span><span class="hl-1">);</span><br/><span class="hl-7">// Output:</span><br/><span class="hl-7">// [</span><br/><span class="hl-7">//   { $match: { isActive: true } },</span><br/><span class="hl-7">//   { $limit: 10 },</span><br/><span class="hl-7">//   { $sample: { size: 10 } }</span><br/><span class="hl-7">// ]</span>
</code><button type="button">Copy</button></pre>

<ul>
<li>Conditional Stages:
<ul>
<li>If you pass <code>null</code> or <code>undefined</code> to any method, the corresponding stage will be skipped.</li>
</ul>
</li>
<li>Supported Stages:
<ul>
<li><code>$match</code>, <code>$sort</code>, <code>$limit</code>, <code>$skip</code>, <code>$lookup</code>, <code>$group</code>, <code>$addFields</code>, <code>$bucket</code>, <code>$bucketAuto</code>, <code>$count</code>, <code>$facet</code>, <code>$project</code>, <code>$unwind</code>, <code>$out</code>, <code>$replaceRoot</code>, <code>$merge</code>, <code>$redact</code>, and <code>$sample</code>.</li>
</ul>
</li>
<li>Returns: The instance of the MongoSenseQueryBuilder for method chaining.</li>
</ul>
<a id="md:contributing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Contributing<a href="#md:contributing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>We welcome contributions! If you find a bug or have a feature request, please open an issue. Pull requests are also welcome.</p>
<p>To contribute:</p>
<ol>
<li>Fork the repository</li>
<li>Create a new branch (<code>git checkout -b feature/your-feature</code>)</li>
<li>Commit your changes (<code>git commit -m 'Add new feature'</code>)</li>
<li>Push to your branch (<code>git push origin feature/your-feature</code>)</li>
<li>Open a pull request</li>
</ol>
<a id="md:license" class="tsd-anchor"></a><h2 class="tsd-anchor-link">License<a href="#md:license" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This repository is licensed under the <strong>MIT License</strong>. See the <a href="media/LICENSE.md">LICENSE</a> file for more details.</p>
<a id="md:additional-license-considerations" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Additional License Considerations:<a href="#md:additional-license-considerations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><strong>Open Source Licensing</strong>: Your project is under the <strong>MIT License</strong>, which is one of the most permissive open-source licenses. It allows others to freely use, modify, and distribute your code as long as they include the original license and copyright notice.</li>
<li><strong>Attribution</strong>: The only requirement is attribution, meaning users must keep your copyright notice and the license terms in any distributed version of your code.</li>
<li><strong>Warranty Disclaimer</strong>: The license disclaims any warranties, protecting you from legal liability if the software doesnâ€™t work as intended.</li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:mongosense-query-builder"><span>Mongo<wbr/>Sense <wbr/>Query <wbr/>Builder</span></a><ul><li><a href="#md:features"><span>Features</span></a></li><li><a href="#md:installation"><span>Installation</span></a></li><li><a href="#md:mongosense-factory-function"><span>Mongo<wbr/>Sense <wbr/>Factory <wbr/>Function</span></a></li><li><a href="#md:usage-example"><span>Usage <wbr/>Example</span></a></li><li><ul><li><a href="#md:output"><span>Output:</span></a></li></ul></li><li><a href="#md:api-documentation"><span>API <wbr/>Documentation</span></a></li><li><ul><li><a href="#md:mongosensedebugmode-boolean--false"><span>Mongo<wbr/>Sense(debug<wbr/>Mode: boolean = false)</span></a></li><li><a href="#md:collection-selector"><span>Collection <wbr/>Selector</span></a></li><li><a href="#md:match-stage"><span>$match <wbr/>Stage</span></a></li><li><a href="#md:sort-stage"><span>$sort <wbr/>Stage</span></a></li><li><ul><li><a href="#md:example"><span>Example:</span></a></li></ul></li><li><a href="#md:limit-and-skip-stages"><span>$limit and $skip <wbr/>Stages</span></a></li><li><ul><li><a href="#md:pagination-logic"><span>Pagination <wbr/>Logic:</span></a></li></ul></li><li><a href="#md:lookup-stage"><span>$lookup <wbr/>Stage</span></a></li><li><a href="#md:group-stage"><span>$group <wbr/>Stage</span></a></li><li><a href="#md:addfields-stage"><span>$add<wbr/>Fields <wbr/>Stage</span></a></li><li><a href="#md:bucket-stage"><span>$bucket <wbr/>Stage</span></a></li><li><a href="#md:bucketauto-stage"><span>$bucket<wbr/>Auto <wbr/>Stage</span></a></li><li><a href="#md:count-stage"><span>$count <wbr/>Stage</span></a></li><li><a href="#md:facet-stage"><span>$facet <wbr/>Stage</span></a></li><li><a href="#md:project-stage"><span>$project <wbr/>Stage</span></a></li><li><a href="#md:unwind-stage"><span>$unwind <wbr/>Stage</span></a></li><li><a href="#md:out-stage"><span>$out <wbr/>Stage</span></a></li><li><a href="#md:replaceroot-stage"><span>$replace<wbr/>Root <wbr/>Stage</span></a></li><li><a href="#md:merge-stage"><span>$merge <wbr/>Stage</span></a></li><li><a href="#md:redact-stage"><span>$redact <wbr/>Stage</span></a></li><li><a href="#md:sample-stage"><span>$sample <wbr/>Stage</span></a></li><li><a href="#md:conditional-query-construction"><span>Conditional <wbr/>Query <wbr/>Construction</span></a></li></ul></li><li><a href="#md:contributing"><span>Contributing</span></a></li><li><a href="#md:license"><span>License</span></a></li><li><ul><li><a href="#md:additional-license-considerations"><span>Additional <wbr/>License <wbr/>Considerations:</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>mongosense</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
